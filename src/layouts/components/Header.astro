---
import HeaderLink from './HeaderLink.astro';
import { Image } from 'astro:assets';
import GithubWhite from '@src/assets/svgs/github-mark-white.svg';
import GithubBlack from '@src/assets/svgs/github-mark.svg';

const menu = [
	{
		link: '/about/',
		label: 'About'
	},
	{
		link: '/posts/',
		label: 'Posts'
	},
	{
		link: '/projects/',
		label: 'Projects'
	},
	{
		link: '/tags/',
		label: 'Tags'
	}
];
---

<header
	id='site-header'
	class:list={[
		'fixed top-0 left-0 right-0 flex items-center w-full transition-all duration-300 z-[1001] backdrop-blur-md bg-white/80 dark:bg-dark-200/80 border-b border-gray-200/50 dark:border-gray-800/50'
	]}
>
	<div class='container'>
		<nav class='flex gap-4 items-center justify-between py-3'>
			<h2 class='m-0'>
				<a href='/' class='group flex gap-3 items-center text-xl font-black'>
					<div class='relative'>
						<div
							class='absolute inset-0 rounded-full bg-gradient-to-r from-primary-400 to-purple-500 blur-[2px] opacity-70 animate-pulse group-hover:opacity-100 transition-opacity'
						>
						</div>
						<img
							src='/profile-zoomed.webp'
							alt='Muhamad Risman'
							class='relative rounded-full w-10 h-10 border-2 border-white dark:border-dark-100 shadow-lg object-cover group-hover:scale-105 transition-transform'
						/>
					</div>
					<span
						class='bg-gradient-to-r from-primary-600 to-purple-600 dark:from-primary-400 dark:to-purple-400 text-transparent bg-clip-text font-bold group-hover:opacity-80 transition-opacity'
						>Risman</span
					>
				</a>
			</h2>

			<!-- Desktop Navigation -->
			<div class='hidden md:flex items-center space-x-1'>
				{
					menu.map((item) => (
						<HeaderLink
							class='relative px-3 py-2 rounded-md text-sm font-medium transition-all hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 group'
							href={item.link}>
							{item.label}
							<span class='absolute bottom-1 left-3 right-3 h-px bg-primary-500 dark:bg-primary-400 transform scale-x-0 transition-transform group-hover:scale-x-100' />
						</HeaderLink>
					))
				}
			</div>

			<div class='flex items-center gap-2'>
				<a
					class='p-2 rounded-full hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all hover:text-primary-600 dark:hover:text-primary-400 dark:hidden'
					href='https://github.com/realrisman'
					target='_blank'><Image src={GithubBlack} width={22} height={22} alt='Github logo' /></a
				>
				<a
					class='p-2 rounded-full hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all hover:text-primary-600 dark:hover:text-primary-400 hidden dark:block'
					href='https://github.com/realrisman'
					target='_blank'><Image src={GithubWhite} width={22} height={22} alt='Github logo' /></a
				>
				<button
					class='p-2 rounded-full hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all hover:text-primary-600 dark:hover:text-primary-400'
					id='themeToggle'
					aria-label='Theme mode'
				>
					<svg
						class='sun'
						xmlns='http://www.w3.org/2000/svg'
						width='22'
						height='22'
						viewBox='0 0 24 24'
						fill='none'
						stroke='currentColor'
						stroke-width='2'
						stroke-linecap='round'
						stroke-linejoin='round'
						><circle cx='12' cy='12' r='4'></circle><path d='M12 2v2'></path><path d='M12 20v2'></path><path d='m4.93 4.93 1.41 1.41'
						></path><path d='m17.66 17.66 1.41 1.41'></path><path d='M2 12h2'></path><path d='M20 12h2'></path><path
							d='m6.34 17.66-1.41 1.41'></path><path d='m19.07 4.93-1.41 1.41'></path></svg
					>
					<svg
						class='moon'
						xmlns='http://www.w3.org/2000/svg'
						width='22'
						height='22'
						viewBox='0 0 24 24'
						fill='none'
						stroke='currentColor'
						stroke-width='2'
						stroke-linecap='round'
						stroke-linejoin='round'
					>
						<path d='M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z'></path></svg
					>
				</button>

				<!-- Mobile menu button -->
				<button
					id='mobile-menu-button'
					class='md:hidden p-2.5 rounded-lg hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all hover:text-primary-600 dark:hover:text-primary-400 border border-gray-200/50 dark:border-gray-800/50'
					aria-label='Toggle menu'
				>
					<svg
						xmlns='http://www.w3.org/2000/svg'
						width='20'
						height='20'
						viewBox='0 0 24 24'
						fill='none'
						stroke='currentColor'
						stroke-width='2'
						stroke-linecap='round'
						stroke-linejoin='round'
						class='menu-icon text-gray-700 dark:text-gray-300'
					>
						<line x1='4' x2='20' y1='12' y2='12'></line>
						<line x1='4' x2='20' y1='6' y2='6'></line>
						<line x1='4' x2='20' y1='18' y2='18'></line>
					</svg>
					<svg
						xmlns='http://www.w3.org/2000/svg'
						width='20'
						height='20'
						viewBox='0 0 24 24'
						fill='none'
						stroke='currentColor'
						stroke-width='2'
						stroke-linecap='round'
						stroke-linejoin='round'
						class='close-icon hidden text-gray-700 dark:text-gray-300'
					>
						<path d='M18 6 6 18'></path>
						<path d='m6 6 12 12'></path>
					</svg>
				</button>
			</div>
		</nav>
	</div>

	<!-- Mobile Navigation Menu -->
	<div id='mobile-menu' class='fixed inset-0 top-0 z-[1000] bg-white/95 dark:bg-dark-200/95 backdrop-blur-lg hidden min-h-screen'>
		<nav class='container h-screen flex flex-col justify-center'>
			<ul class='space-y-3 -mt-16'>
				{
					menu.map((item) => {
						const isActive = Astro.url.pathname === item.link || Astro.url.pathname === '/' + item.link.split('/')[1];
						return (
							<li>
								<a
									href={item.link}
									class:list={[
										'group block py-4 px-6 text-xl font-medium transition-all duration-200 rounded-xl',
										{
											'text-primary-600 dark:text-primary-400 bg-primary-50/50 dark:bg-primary-900/30': isActive,
											'text-gray-800 dark:text-gray-200 hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:text-primary-600 dark:hover:text-primary-400':
												!isActive
										}
									]}>
									<span class='relative'>
										{item.label}
										{!isActive && (
											<span class='absolute bottom-0 left-0 right-0 h-px bg-primary-500 dark:bg-primary-400 transform scale-x-0 transition-transform group-hover:scale-x-100' />
										)}
									</span>
								</a>
							</li>
						);
					})
				}
				<li class='pt-6'>
					<div class='h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent'></div>
					<a
						href='mailto:real.risman@gmail.com'
						class='group mt-6 block py-4 px-6 text-xl font-medium text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all duration-200 rounded-xl'
					>
						<div class='flex items-center gap-3'>
							<svg
								xmlns='http://www.w3.org/2000/svg'
								width='20'
								height='20'
								viewBox='0 0 24 24'
								fill='none'
								stroke='currentColor'
								stroke-width='2'
								stroke-linecap='round'
								stroke-linejoin='round'
								class='transition-transform group-hover:scale-110'
							>
								<path d='M5 7.2A2.2 2.2 0 0 1 7.2 5h9.6A2.2 2.2 0 0 1 19 7.2v9.6a2.2 2.2 0 0 1-2.2 2.2H7.2A2.2 2.2 0 0 1 5 16.8V7.2Z'
								></path>
								<path d='m5 7 7 7 7-7'></path>
							</svg>
							Contact Me
						</div>
					</a>
				</li>
			</ul>
		</nav>
	</div>

	<style is:global>
		#themeToggle .moon {
			display: none;
		}
		.dark #themeToggle .sun {
			display: none;
		}
		.dark #themeToggle .moon {
			display: block;
		}

		/* Add smooth animation for mobile menu */
		#mobile-menu {
			transition: opacity 0.3s ease-in-out;
			opacity: 0;
			pointer-events: none;
		}

		#mobile-menu:not(.hidden) {
			opacity: 1;
			pointer-events: auto;
		}

		/* Add hover animation for header links */
		@keyframes linkHover {
			0% {
				width: 0;
				left: 50%;
				right: 50%;
			}
			100% {
				width: 100%;
				left: 0;
				right: 0;
			}
		}
	</style>

	<script is:inline>
		const theme = (() => {
			if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
				return 'dark';
			}
			if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
				return localStorage.getItem('theme');
			}
			return 'light';
		})();

		if (theme === 'light') {
			document.documentElement.classList.remove('dark');
		} else {
			document.documentElement.classList.add('dark');
		}

		window.localStorage.setItem('theme', theme || '');

		function sendMessage(message) {
			const iframe = document.querySelector('iframe.giscus-frame');
			if (!iframe) return;
			iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
		}

		const handleToggleClick = () => {
			const element = document.documentElement;
			element.classList.toggle('dark');

			const isDark = element.classList.contains('dark');
			if (isDark) {
				sendMessage({
					setConfig: {
						theme: 'dark_dimmed'
					}
				});
			} else {
				sendMessage({
					setConfig: {
						theme: 'light'
					}
				});
			}
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		};
		document.getElementById('themeToggle')?.addEventListener('click', handleToggleClick);

		// Mobile menu toggle with smooth animation
		document.addEventListener('DOMContentLoaded', () => {
			const mobileMenuButton = document.getElementById('mobile-menu-button');
			const mobileMenu = document.getElementById('mobile-menu');
			const menuIcon = document.querySelector('.menu-icon');
			const closeIcon = document.querySelector('.close-icon');

			if (mobileMenuButton && mobileMenu) {
				mobileMenuButton.addEventListener('click', () => {
					mobileMenu.classList.toggle('hidden');
					menuIcon.classList.toggle('hidden');
					closeIcon.classList.toggle('hidden');
					document.body.classList.toggle('overflow-hidden');
				});

				// Close menu when clicking on a link
				const mobileLinks = mobileMenu.querySelectorAll('a');
				mobileLinks.forEach((link) => {
					link.addEventListener('click', () => {
						mobileMenu.classList.add('hidden');
						menuIcon.classList.remove('hidden');
						closeIcon.classList.add('hidden');
						document.body.classList.remove('overflow-hidden');
					});
				});
			}
		});
	</script>
</header>
